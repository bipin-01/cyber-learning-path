services:
  promtail:
    image: grafana/promtail:2.9.8
    container_name: promtail
    entrypoint: ["/usr/bin/promtail"]
    command:
      - -config.file=/etc/promtail/config.yml
      - -client.url=http://loki:3100/loki/api/v1/push   # guarantees a client exists
    ports:
      - "9080:9080"
    volumes:
      - /var/lib/docker/containers:/var/lib/docker/containers:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ./promtail/config.yml:/etc/promtail/config.yml:ro
    networks:
      - lab-net
    healthcheck:
      test: ["CMD", "/usr/bin/promtail", "-version"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s

networks:
  lab-net:
    external: true
    name: day1-lab_lab-net
